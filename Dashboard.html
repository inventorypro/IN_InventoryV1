<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Simple Sidebar - Start Bootstrap Template</title>

    <script src="script/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Bootstrap core CSS -->
    <!-- <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"> -->

    <!-- Custom styles for this template -->
    <link href="css/simple-sidebar.css" rel="stylesheet">
    <!-- ////datatable///// -->

    <script src="script/jquery-3.3.1.js"></script>
    <script src="script/1.10.19/js/jquery.dataTables.min.js"></script>

    <script src="script/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="script/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script src="script/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script src="script/buttons/1.5.2/js/buttons.html5.min.js"></script>
    <script src="script/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
    <script src="script/buttons/1.5.2/js/buttons.colVis.min.js"></script>

    <script src="script/1.10.19/js/dataTables.bootstrap4.min.js"></script>


    <link rel="stylesheet" href="script/ajax/libs/twitter-bootstrap/4.1.1/css/bootstrap.css">
    <link rel="stylesheet" href="script/1.10.19/css/dataTables.bootstrap4.min.css">

    <script src="script/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>


    <link rel="stylesheet" href="script/buttons/1.5.2/css/buttons.dataTables.min.css">

    <script src="script/bootstrap/4.2.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="script/bootstrap/4.2.1/css/bootstrap.min.css">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css"
        integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Sarabun" rel="stylesheet">
    <script src="script/ajax/libs/moment.js/2.18.1/moment.min.js"></script>


    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- https://material.io/tools/icons/?icon=shopping_cart&style=baseline -->
    <!-- ////my script//// -->
    <script src="js/index.js"></script>
    <script src="js/admin.js"></script>

    <script src="js/product.js"></script>

</head>

<body>

    <script>

    </script>
    <nav class="navbar fixed-top">
        <span class="navbar-brand mb-0 h1">Navbar</span>
        <a href="#menu-toggle" class="btn" id="menu-toggle"><i class="fas fa-bars setIconbarSize"></i></a>
    </nav>
    <div id="wrapper" class="toggled">

        <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <ul class="sidebar-nav">
                <li class="sidebar-brand">
                    <p id="myUsername"></p>
                </li>
                <hr>
                <li class="active">
                    <a href="Dashboard.html">Dashboard</a>
                </li>
                <li>
                    <a href="AdminRequis.html">All Requisition</a>
                </li>
                <li>
                    <a href="LocationSite.html">Locations</a>
                </li>
                <li>
                    <a data-toggle="collapse" href="#multiCollapseExample1" aria-expanded="false"
                        aria-controls="multiCollapseExample1" style="color:black;">Report</a>
                </li>
                <div class="collapse multi-collapse" id="multiCollapseExample1">
                    <ul>
                        <li>
                            <a href="BalanceReport.html">Balance Report</a>
                        </li>
                        <li>
                            <a href="ReceiveReport.html">Receive Report</a>
                        </li>
                        <li>
                            <a href="#">Return Report</a>
                        </li>
                        <li>
                            <a href="#">Requisition Report</a>
                        </li>
                        <li>
                            <a href="#">Low Product Report</a>
                        </li>
                        <li>
                            <a href="#">Out of Stock Report</a>
                        </li>
                        <li>
                            <a href="#">Total Cost Report</a>
                        </li>
                    </ul>
                </div>
                <li>
                    <a href="#" onclick="clearProduct()">Contact</a>
                </li>
                <li>
                    <a href="#" onclick="fnLogout()">Logout</a>
                </li>
            </ul>
        </div>
        <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div class="container-fluid setMycontainer">
            <div class="row">
                <div class="col-sm-3">
                    <div class="card border-success mb-3">
                        <div class="card-body text-success">
                            <div class="row">
                                <div class="col-8">
                                    <h5 class="card-title">เบิกได้</h5>
                                    <p class="card-text" id="showCountProduct">0</p>
                                </div>
                                <div class="sizeFontIcon"><i class="fas fa-check"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="card border-secondary mb-3">
                        <div class="card-body text-secondary">
                            <div class="row">
                                <div class="col-8">
                                    <h5 class="card-title">งดการเบิก</h5>
                                    <p class="card-text" id="showCountProductFalse">0</p>
                                </div>
                                <div class="sizeFontIcon"><i class="fas fa-times  sizeFontIcon"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="card border-warning mb-3">
                        <div class="card-body text-warning">
                            <div class="row">
                                <div class="col-8">
                                    <h5 class="card-title">ใกล้หมดสต็อก</h5>
                                    <p class="card-text" id="showcountProductMinValue">0</p>
                                </div>
                                <div class="sizeFontIcon"><i class="fas fa-sort-amount-down sizeFontIcon"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3">
                    <div class="card border-danger mb-3">
                        <div class="card-body text-danger">
                            <div class="row">
                                <div class="col-8">
                                    <h5 class="card-title">หมดสต็อก</h5>
                                    <p class="card-text" id="showcountProductAmount">0</p>
                                </div>
                                <div class="sizeFontIcon"><i class="fas fa-exclamation-circle sizeFontIcon"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- /#page-content-wrapper -->
        <div id="page-content-wrapper">
            <div class="container-fluid setFont"><br>
                <button type="button" class="btn btn-success float-right" data-toggle="modal"
                    data-target="#myModalAddNew">Add New Product</button>
                <h1>Product list</h1>
                <hr>
                <style>
                    button.dt-button,
                    div.dt-button,
                    a.dt-button {
                        background-image: none;
                        background-color: #dc3545;
                        border-color: #dc3545;
                        color: rgb(255, 255, 255);
                        position: relative;
                        display: inline-block;
                    }

                    button.dt-button:hover:not(.disabled),
                    div.dt-button:hover:not(.disabled),
                    a.dt-button:hover:not(.disabled) {
                        color: rgb(255, 255, 255);
                        border: 1px solid rgb(63, 63, 63);
                        background-color: rgb(200, 35, 51);
                        background-image: -webkit-linear-gradient(top, #dc3545 0%, rgb(200, 35, 51) 100%);
                        background-image: -moz-linear-gradient(top, #f9f9f9 0%, #e0e0e0 100%);
                        background-image: -ms-linear-gradient(top, #f9f9f9 0%, #e0e0e0 100%);
                        background-image: -o-linear-gradient(top, #f9f9f9 0%, #e0e0e0 100%);
                        background-image: linear-gradient(to bottom, #dc3545 0%, rgb(200, 35, 51) 100%);

                        filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, StartColorStr='#f9f9f9', EndColorStr='#e0e0e0');
                    }

                    div.dt-button-collection button.dt-button.active:not(.disabled) {
                        color: rgb(0, 0, 0);
                        background-image: linear-gradient(to bottom, #727272 0%, #727272 100%);
                    }
                </style>

                <div class="row-fluid">
                    <div class="table-responsive">

                        <table id="example" class="table table-striped table-bordered text-center dtCheck">

                            <thead>

                                <tr>
                                    <th>Select</th>
                                    <th>ProductID</th>
                                    <th>Product</th>
                                    <th>ProductName</th>
                                    <th>Category</th>
                                    <th>UnitType</th>
                                    <th>Price</th>
                                    <th>MinValue</th>
                                    <th>MaxValue</th>
                                    <th>Barcode</th>
                                    <th>Vender</th>
                                    <th>Place</th>
                                    <th>ProductStatus</th>
                                    <th>ImgProduct</th>
                                    <th>Amount</th>
                                    <th>SITES</th>
                                    <th>EDIT</th>
                                    <th>DELETE</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th>Select</th>
                                    <th>ProductID</th>
                                    <th>Product</th>
                                    <th>ProductName</th>
                                    <th>Category</th>
                                    <th>UnitType</th>
                                    <th>Price</th>
                                    <th>MinValue</th>
                                    <th>MaxValue</th>
                                    <th>Barcode</th>
                                    <th>Vender</th>
                                    <th>Place</th>
                                    <th>ProductStatus</th>
                                    <th>ImgProduct</th>
                                    <th>Amount</th>
                                    <th>SITES</th>
                                    <th>EDIT</th>
                                    <th>DELETE</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>

                <input type="checkbox" onClick="toggleCheckbox(this)" /> Toggle All
                <button type="button" class="btn btn-danger" onclick="multiDelete()">Delete</button> <br><br>

            </div>
        </div>

    </div>


    <!-- The Modal -->
    <div class="modal" id="myModal">

        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Edit</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div id="loader" style="display:none;"> </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <input type="hidden" class="form-control" id="editProductID">
                    editProductName: <input type="text" class="form-control" id="editProductName">
                    editCategory: <input type="hidden" class="form-control" id="editCategory">
                    <select class="form-control" id="setCategory" onclick="setVarDdlCategory()"> </select>
                    <div id="showPackProduct">

                    </div>

                    editUnitType:
                    <input type="hidden" class="form-control" id="editUnitType">
                    <select class="form-control" id="setUnitType" onclick="setVarDdlUnitType()"> </select>
                    editPrice: <input type="number" class="form-control" id="editPrice">
                    editMinValue: <input type="number" class="form-control" id="editMinValue">
                    editMaxValue: <input type="number" class="form-control" id="editMaxValue">
                    editBarcode: <input type="text" class="form-control" id="editBarcode">
                    editVender: <input type="text" class="form-control" id="editVender">
                    editPlace: <input type="text" class="form-control" id="editPlace">
                    editProductStatus: <input type="text" class="form-control" id="editProductStatus">
                    editAmount: <input type="number" class="form-control" id="editAmount">
                    editSITES: <input type="text" class="form-control" id="editSITES">
                    <input type="hidden" class="form-control" id="editImgProduct">
                    ImgProduct:
                    <center><img id="editImgProductShow" height="200" src="" alt="your image" /></center>
                    <div class="form-group">
                        <input type="file" id="myfileUpload" /><br>
                        <center><img id="myImgUpload" height="200" src="" alt="new image product" /></center>

                    </div>

                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal"
                        onclick="btnEditProduct()">Save</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>

    </div>



    <!-- The Modal -->
    <div class="modal setFont" id="myModalAddNew">

        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Add New Product</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <div id="loader" style="display:none;"> </div>
                <!-- Modal body -->

                <div class="modal-body">
                    <form id="myform">

                        <!-- ProductID: <input type="text" class="form-control" id="addProductID"> -->
                        ProductName: <input type="text" name="field" class="form-control xxxx" id="addProductName"
                            required />

                        Category: <input type="hidden" class="form-control" id="addCategory" required />
                        <select class="form-control checkAmountClassname" id="addsetCategory" placeholder="select"
                            onclick="addsetVarDdlCategory()" required>
                            <option disabled selected value="">Please select Category</option>
                        </select>

                        <div id="addPackProduct">
                            <br> <button class="btn btn-success" type="button" onclick="addButton()">Add</button>
                            <!-- <button onclick="checkVall()">คำนวนราคาทั้งหมด</button> -->
                            <br><br>
                        </div>

                        UnitType: <input type="hidden" class="form-control" id="addUnitType" required>
                        <select class="form-control " id="addsetUnitType" onclick="addsetVarDdlUnitType()" required>
                            <option disabled selected value="">Please select UnitType</option>
                        </select>
                        Price: <input type="number" class="form-control" id="addPrice" required>
                        MinValue: <input type="number" class="form-control" id="addMinValue" required>
                        MaxValue: <input type="number" class="form-control" id="addMaxValue" required>
                        Barcode: <input type="text" class="form-control" id="addBarcode" required>
                        Vender: <input type="text" class="form-control" id="addVender" required>
                        Place: <input type="text" class="form-control" id="addPlace" required>
                        <!-- ProductStatus: <input type="text" class="form-control" id="addProductStatus"> -->
                        Amount: <input type="number" class="form-control" id="addAmount" required>
                        <!-- SITES: <input type="text" class="form-control" id="addSITES"> -->
                        <input type="hidden" class="form-control" id="addImgProduct" required>
                        ImgProduct:
                        <div class="form-group">
                            <input type="file" id="myfileUpload" /><br>
                            <center><img id="myImgUpload2" height="200" src="" alt="new image product" /></center>

                        </div>


                </div>


                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="addNewProduct()">Add</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>
                </form>
            </div>
        </div>

    </div>
    <!-- /#wrapper -->

    <!-- Bootstrap core JavaScript -->
    <!-- <script src="vendor/jquery/jquery.min.js"></script> -->
    <!-- <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script> -->

    <!-- Menu Toggle Script -->


</body>
<script>
    // just for the demos, avoids form submit

    !function (a) { var b = /iPhone/i, c = /iPod/i, d = /iPad/i, e = /(?=.*\bAndroid\b)(?=.*\bMobile\b)/i, f = /Android/i, g = /(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i, h = /(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i, i = /IEMobile/i, j = /(?=.*\bWindows\b)(?=.*\bARM\b)/i, k = /BlackBerry/i, l = /BB10/i, m = /Opera Mini/i, n = /(CriOS|Chrome)(?=.*\bMobile\b)/i, o = /(?=.*\bFirefox\b)(?=.*\bMobile\b)/i, p = new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)", "i"), q = function (a, b) { return a.test(b) }, r = function (a) { var r = a || navigator.userAgent, s = r.split("[FBAN"); return "undefined" != typeof s[1] && (r = s[0]), s = r.split("Twitter"), "undefined" != typeof s[1] && (r = s[0]), this.apple = { phone: q(b, r), ipod: q(c, r), tablet: !q(b, r) && q(d, r), device: q(b, r) || q(c, r) || q(d, r) }, this.amazon = { phone: q(g, r), tablet: !q(g, r) && q(h, r), device: q(g, r) || q(h, r) }, this.android = { phone: q(g, r) || q(e, r), tablet: !q(g, r) && !q(e, r) && (q(h, r) || q(f, r)), device: q(g, r) || q(h, r) || q(e, r) || q(f, r) }, this.windows = { phone: q(i, r), tablet: q(j, r), device: q(i, r) || q(j, r) }, this.other = { blackberry: q(k, r), blackberry10: q(l, r), opera: q(m, r), firefox: q(o, r), chrome: q(n, r), device: q(k, r) || q(l, r) || q(m, r) || q(o, r) || q(n, r) }, this.seven_inch = q(p, r), this.any = this.apple.device || this.android.device || this.windows.device || this.other.device || this.seven_inch, this.phone = this.apple.phone || this.android.phone || this.windows.phone, this.tablet = this.apple.tablet || this.android.tablet || this.windows.tablet, "undefined" == typeof window ? this : void 0 }, s = function () { var a = new r; return a.Class = r, a }; "undefined" != typeof module && module.exports && "undefined" == typeof window ? module.exports = r : "undefined" != typeof module && module.exports && "undefined" != typeof window ? module.exports = s() : "function" == typeof define && define.amd ? define("isMobile", [], a.isMobile = s()) : a.isMobile = s() }(this);
    // alert(isMobile.any ? 'Mobile' : 'Not mobile');
    var mobileOrWeb = isMobile.any;
    //console.log(mobileOrWeb);
    if (mobileOrWeb === true) {
        $("#wrapper").toggleClass("toggled");
    } else {

    }
    $(document).ready(function () {

        document.getElementById("loader").style.display = "none";
        ddlUnitType(); //drop down list unit type
        ADDddlUnitType();//drop down list unit type *Add
        ddlCategory();
        ADDddlCategory();
        $("#menu-toggle").click(function (e) {
            e.preventDefault();
            $("#wrapper").toggleClass("toggled");
        });


        $('#exampleModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever') // Extract info from data-* attributes
            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            var modal = $(this)
            modal.find('.modal-title').text('New message to ' + recipient)
            modal.find('.modal-body input').val(recipient)
        })

        // function readURL(input) {

        //     if (input.files && input.files[0]) {
        //         var reader = new FileReader();

        //         reader.onload = function (e) {
        //             $('#blah').attr('src', e.target.result);
        //         }

        //         reader.readAsDataURL(input.files[0]);
        //     }
        // }
        // $("#myfileUpload").change(function () {

        //     var fileName = document.getElementById("myfileUpload").value;
        //     var idxDot = fileName.lastIndexOf(".") + 1;
        //     var extFile = fileName.substr(idxDot, fileName.length).toLowerCase();
        //     if (extFile == "jpg" || extFile == "jpeg" || extFile == "png") {
        //         readURL(this);
        //         document.getElementById("loader").style.display = "block";

        //     } else {
        //         $('#myfileUpload').val("");
        //         alert("Only jpg/jpeg and png files are allowed!");
        //     }
        // });
        // document.getElementById("loader").style.display = "none";
        $('input[type=file]').on("change", function () {

            var $files = $(this).get(0).files;

            if ($files.length) {

                // Reject big files
                if ($files[0].size > $(this).data("max-size") * 1024) {
                    console.log("Please select a smaller file");
                    return false;
                }

                // Replace ctrlq with your own API key
                var apiUrl = 'https://api.imgur.com/3/image';
                var apiKey = 'b8732e440376e3d';
                // document.getElementById("loader").style.display = "none";
                var formData = new FormData();
                formData.append("image", $files[0]);

                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": apiUrl,
                    "method": "POST",
                    "datatype": "json",
                    "headers": {
                        "Authorization": "Client-ID " + apiKey
                    },
                    "processData": false,
                    "contentType": false,
                    "data": formData,
                    beforeSend: function (xhr) {
                        console.log("Uploading...");
                    },
                    success: function (res) {

                        document.getElementById("myImgUpload").src = res.data.link;
                        document.getElementById("myImgUpload2").src = res.data.link;
                        console.log(res.data.link);

                        document.getElementById("addImgProduct").value = res.data.link;
                        document.getElementById("addImgProductShow").src = data.ImgProduct;
                        document.getElementById("editImgProduct").value = res.data.link;
                        document.getElementById("editImgProductShow").src = data.ImgProduct;
                        // document.getElementById("loader").style.display = "block";
                        // $('body').append('<img src="' + res.data.link + '" />');
                    },
                    error: function () {
                        alert("Failed");
                    }
                }
                $.ajax(settings).done(function (response) {
                    console.log("Done");
                });

            }
        });
        ///cont product
        var countProduct = 0;
        var countProductFalse = 0;
        var countProductMinValue = 0;
        var countProductAmount = 0;
        $.ajax({

            type: "GET",
            url: "http://localhost:60443/api/IN_Product?sites=" + localStorage.logSite,
            dataType: 'json',
            headers: {
                'Authorization': 'basic ' + btoa(localStorage.logUsername + ':' + localStorage.logPassword)
            },


            success: function (data) {
                for (var i = 0; i < data.length; i++) {
                    if (data[i].ProductStatus === "true" && data[i].Amount != 0) {
                        countProduct += 1;
                    } else if (data[i].ProductStatus === "false") {
                        countProductFalse += 1;
                    }
                    if (data[i].Amount <= data[i].MinValue && data[i].Amount != 0) {
                        countProductMinValue += 1;
                    }
                    if (data[i].Amount === 0) {
                        countProductAmount += 1;
                    }
                }
                console.log(countProduct);
                document.getElementById("showCountProduct").innerHTML = countProduct;
                document.getElementById("showCountProductFalse").innerHTML = countProductFalse;
                document.getElementById("showcountProductMinValue").innerHTML = countProductMinValue;
                document.getElementById("showcountProductAmount").innerHTML = countProductAmount;

            },
            error: function (jqXHR, xhr, ajaxOptions, thrownError) {
                console.log("+++++++++++++++++++++++++  Bot notification failed, error is '" + thrownError + "'");
                //window.location.href = "index.html";
            }
        });



    });

</script>

</html>